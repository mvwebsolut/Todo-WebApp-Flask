{% extends "includes/base.html" %}
{% block title %}My Lists{% endblock %}
{% block content %}
<style>

#wraper {
      position: absolute;
      width: 400px;
      left: 50%;
      margin-left: -200px;
      top: 100px;
  }

  input {
      padding-bottom: 30px;
  }


  .icon-popup {
      position: absolute;
      width: 278px;
      height: 268px;
      color: #000;
      font-size: 14px;
  }

  .icon-popup:before {
      content: '';
      display: inline-block;
      border-left: 7px solid transparent;
      border-right: 7px solid transparent;
      border-bottom: 7px solid #ccc;
      border-bottom-color: rgba(0, 0, 0, 0.2);
      position: absolute;
      top: -7px;
      left: 6px;
  }

  .icon-popup:after {
      content: '';
      display: inline-block;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-bottom: 6px solid #fff;
      position: absolute;
      top: -6px;
      left: 7px;
  }

  .icon-popup a:hover {
      background-color: #eee;
  }

  .icon-popup .icon-title {
      position: relative;
      background-color: #563d7c;
      color: #fff;
      border: 1px solid #463265;

  }

  .icon-popup .icon-title h4 {
      margin: 0;
      padding: 8px 10px;
      font-size: 17px;
      font-weight: bold;
  }

  .pointer {
      cursor: pointer;
  }

  .icon-popup .ip-control {
      background-color: white;
      height: 40px;
      margin-top: -2px;
      padding-top: 2px;
      border-bottom: 1px solid #e5e5e5;
  }

  .icon-popup .ip-search {
      width: 171px;
      padding: 2px 0px 5px 27px;
      margin-left: 8px;
      background-repeat: no-repeat;
      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAQAAAAEABcxq3DAAACcElEQVQ4y5XSQUiaYRgH8P+rzlSS6lKuZbkvvjq0NWfg0Xu1jO0gWbO5ctBtxDrtsE51CIJZgxWLMQbtsA7TQ5RX5ygPFbRD1rBJDko+ZtI++fT7nM8uDpoWrD+8p/d5fu8Dz8tQChEZs9nsk4ODgwcnJye8RqNRmpubd3ief69Wq1dwSTSl5tbt7e2VYDB4N51Ow2AwoFgsQpKkGxzH3Usmkx+amppGGWO5coARkXFra+vzwuLCnVau9ai3t3fWbDZHC4WCPhaL3Q8EAmMqxrTPJiYWTSbTWMUIv0Tx6fj4OE1OTsay2ewLIpo9f59IfPf6fD7l1fw8EVFXeb/q6+6uK5FIwOl0rhoMBhlA5HyBxXLzncPhWN/Y3IQgCP0VwOHhIQcALS0tqwDeMMY+lRfxPB8WBAHHx8dcBQBAyWQykGVZwxj7SUS6sqMSRdEoiiJUKpVSsYW2tradVCplDofDLiI6BVAPoACAlR44Da2HempqamCxWL5UAFardamzs9M5NTXt5nk+bbPZJAAmAL8B/FheXr4VCAa6bDYbdHodVawRAPb29t4ODAw8FgShODw8vGG321O5XE4dCoW4tbW120ajEfl8Hn19fTm/3/9Iq9V+/EchomvxePyl1+stNNQ3kE6nI71eTx0dHdTT3U11dXV0vbGRqquraWRkRM7n864LvyURWY+Oks8jkchSNBp9nclkfLIse0ZHfRIAqq2tJcYYDT0cuhy5KIqi9Hs8HgkAVVVVEQByuVzy2dnZ1ZDBwUEJADHGCADNzMyk/xv4i7jdbgkAtbe30/7+/vSVAACQZdk5Nzf3LR6PTwHAHzdFLfF/9+ryAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDEwLTAyLTExVDExOjIxOjA0LTA2OjAw10lxMgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAwNi0wNS0zMFQxMToxMzowNi0wNTowMGfB+zwAAAAASUVORK5CYII=) no-repeat 3px;

  }

  .icon-popup .icon-list {
      position: absolute;
      top: 43px;
      bottom: 0;
      overflow: hidden;
  }

  .icon-list ul {
      margin: 0;
      padding: 0;
      margin-bottom: 10px;
  }

  .icon-popup .ip-control ul {
      margin: 4px 0;
      padding: 0;
  }

  .icon-popup .ip-control ul li {
      float: left;
      list-style-type: none;
  }

  .icon-popup .ip-control ul li a {
      margin-top: -3px;
      color: #373737;
  }

  .icon-popup .ip-control ul li:first-child {
      margin-left: 3px;
  }

  .icon-popup .ip-control ul li:last-child {
      position: absolute;
      right: 0;
      top: 9px;
  }

  .icon-list ul li {
      display: inline-block;
      margin: 5px;
      float: left;
      border: 1px dotted #eee;
  }

  .icon-list ul li a {
      display: block;
      text-decoration: none;
      color: #373737;
      padding: 6px 10px;
  }

  .icon-list ul li a:hover {
      color: #000;
  }

  .placeholder-square {
    border: 2px dashed #f0f0f0;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
  }

  .placeholder-square:hover {
    cursor: pointer;
    border: 2px dashed var(--bs-success);
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
  }
  

  .placeholder-square .plus-icon {
    font-size: 24px;
    margin-bottom: 8px;
  }
</style>
<div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel"
    tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalToggleLabel">Add New List</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="my-lists">
                    {{ form.csrf_token() }}
                    <div class="mb-3">
                        <label for="" class="col-form-label">Name:</label>
                        {{ form.name(class_="form-control") }}
                    </div>
                    <div class="mb-3">
                        <label for="" class="col-form-label">Icon:</label>
                        {{ form.icon(class_="form-control emoji-tri") }}
                    </div>
                    {{ form.add(class_="btn btn-primary") }}
                </form>
            </div>
        </div>
    </div>
</div>
<div class="row row-cols-1 row-cols-md-4">

  <div class="col-lg-6 mb-4">
    <div class="placeholder-square w-100 pt-5 pb-5" href="#exampleModalToggle" data-bs-toggle="modal">
      <span class="plus-icon">+</span>
      <a>Add List</a>
    </div>
  </div>

  {% for lists in current_user.lists %}
  <!-- List Item -->
    <div class="col-lg-6">
      <div class="card overflow-hidden">
        <div class="card-body p-4">
          <div class="col row-cols-2 space-arround d-flex">
            <h5 class="title fw-semibold">{{ lists.title }}</h5>
            <div class="d-flex justify-content-end">
              {% if lists.completed_att is not none %}
                <p class="fs-4 me-1 fw-bold">{{ lists.create_att.strftime('%d/%m/%Y') }}</p>
                <i class="ti ti-calendar text-primary" style="font-size: 18pt;"></i>
              {% else %}
                <i class="ti ti-infinity text-primary" style="font-size: 18pt;"></i>
              {% endif %}
            </div>
          </div>        
          <div class="row align-items-center">
            <div class="col-8">
              <div class="col d-flex align-items-center mb-3">
                <h4 class="fw-semibold">{{ lists.id | completed_tasks_filter }}</h4>
                <p class="muted"> / {{lists.notes|length}}</p>
              </div>
              <div class="d-flex align-items-center">
                <div class="me-4">
                  <a class="btn btn-outline-primary" href="my-list/{{lists.id}}">View</a>
                </div>
                <div>
                  <a onclick="deleteItem({{lists.id}});" class="btn btn-outline-danger delete_list">Delete</a>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="d-flex justify-content-end ">
                <span class="" style="font-size: 3em;">{{ lists.icon }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<script src="/static/assets/js/vanillaEmojiPicker.js"></script>
<script>

    new EmojiPicker({
        trigger: [
            {
                selector: '.emoji-tri',
                insertInto: ['.emoji-tri'] // '.selector' can be used without array
            }
        ],
        closeButton: true,
        //specialButtons: green
    });

</script>

<script>
  function deleteItem(id) {
            fetch('my-lists/' + id, {
                method: 'DELETE',
            })
            .then(response => {
              console.log('Item excluído com sucesso', response);
              window.location.reload();
            })
            .then(data => {
                // Lida com a resposta do servidor
                console.log('Item excluído com sucesso', data);
            })
            .catch(error => {
                console.error('Erro ao excluir o item', error);
            });
        }
</script>

{% endblock %}